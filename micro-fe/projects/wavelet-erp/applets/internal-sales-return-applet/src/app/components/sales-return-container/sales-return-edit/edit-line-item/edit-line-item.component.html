<mat-card-title class="column-title">
  <div fxLayout="row" fxLayoutAlign="space-between end">
    <div>
      <button #navBtn mat-button class="blg-button-icon" matTooltip="Back" type="button"
        [disabled]="deactivateReturn$ | async" (click)="onReturn()">
        <img [ngClass]="navBtn.disabled ? 'blg-button-disabled' : null" src="../../../assets/images/backbutton.png"
          alt="add" width="40px" height="40px">
      </button>
      <span>Edit Item</span>
    </div>
    <div fxFlex="1 0 25" fxLayout="row" fxLayoutAlign="end" fxLayoutGap="5px">
      <button mat-raised-button color="primary" type="button" [disabled]="disableSave()"
        (click)="onSave()">SAVE</button>
    </div>
  </div>
</mat-card-title>
<br>
<mat-tab-group mat-stretch-tabs [dynamicHeight]="true" [selectedIndex]="selectedIndex$ | async" *ngIf="!showPanels()">
  <mat-tab label="Item Details">
    <app-line-item-details [selectedIndex]="itemSelectedIndex$" [editMode]="true"></app-line-item-details>
  </mat-tab>
   <mat-tab *ngIf="itemData?.bl_fi_mst_item_hdr?.txn_type==='GROUPED_ITEM'" label="Grouped Item">
    <app-line-item-group-item
    [mode]="'edit'"
    [lineItem]="lineItem"
    [itemHdr]="itemData?.bl_fi_mst_item_hdr"
    ></app-line-item-group-item>
  </mat-tab>
  <mat-tab *ngIf="subItemType === 'SERIAL_NUMBER'" label="Serial Number" [aria-label]="serialNumberTabColor$|async">
    <app-util-line-item-serial-number
    [selectedIndex$]="serialSelectedIndex$"
    [editMode]="true"
    [txnType] = "'PURCHASE'"
    [postingStatus] = "postingStatus"
    [viewModelStore]="viewModelStore"
    [ColumnViewActions]="ColumnViewActions"
    [ColumnViewSelectors]="ColumnViewSelectors"
    [serialNumberListing$] ="serialNumberListing$"
    [draft$] ="draft$"
    [invItem$] ="invItem$"
    [lineItem] ="docline$ | async"
    [serverDocType]="serverDocType"
    ></app-util-line-item-serial-number>
  </mat-tab>
  <mat-tab label="Costing Details" *ngIf="!appletSettings.HIDE_COSTING_DETAILS || showCostingDetails">
    <app-line-item-costing-details></app-line-item-costing-details>
  </mat-tab>
  <!-- <mat-tab label="Pricing Details">
    <app-line-item-pricing-details></app-line-item-pricing-details>
  </mat-tab> -->
  <mat-tab label="Issue Link">
    <app-line-item-issue-link-listing (editIssueLink)="goToEditIssueLink()"></app-line-item-issue-link-listing>
  </mat-tab>

  <!-- <mat-tab label="KO By Sales Order Item">
		<app-doc-link-ko-by
			[selectedLineItem$]="lineItem$"
			[links$]="links$"
			[hdr]="draft$ | async"
			[AppletConstants]="AppletConstants"
			[serverDocTypeDoc2]="'INTERNAL_SALES_ORDER'"
			[service]="InternalSalesOrderService"
		></app-doc-link-ko-by>
	</mat-tab>
	<mat-tab label="KO For Sales Order Item">
		<app-doc-link-ko-for
			[localState]="localState$ | async"
			[selectedLineItem$]="lineItem$"
			[links$]="links$"
			[hdr]="draft$ | async"
			[store]="store"
			[GenDocActions]="GenDocActions"
			[draftStore]="draftStore"
			[AppletConstants]="AppletConstants"
			[serverDocTypeDoc1]="'INTERNAL_SALES_ORDER'"
			[service]="InternalSalesOrderService"
			[LinkActions]="LinkActions"
			[LinkSelectors]="LinkSelectors"
			[PNSActions]="PNSActions"
			[PNSSelectors]="PNSSelectors"
			(addKO)="onKnockoffAdd($event)"
			(showDetails)="onKnockoffEdit($event)"
		></app-doc-link-ko-for>
	</mat-tab>

  <mat-tab label="KO By Jobsheet Item">
		<app-doc-link-ko-by
			[selectedLineItem$]="lineItem$"
			[links$]="links$"
			[hdr]="draft$ | async"
			[AppletConstants]="AppletConstants"
			[serverDocTypeDoc2]="'INTERNAL_JOBSHEET'"
			[service]="InternalJobsheetService"
		></app-doc-link-ko-by>
	</mat-tab>
	<mat-tab label="KO For Jobsheet Item">
		<app-doc-link-ko-for
			[localState]="localState$ | async"
			[selectedLineItem$]="lineItem$"
			[links$]="links$"
			[hdr]="draft$ | async"
			[store]="store"
			[GenDocActions]="GenDocActions"
			[draftStore]="draftStore"
			[AppletConstants]="AppletConstants"
			[serverDocTypeDoc1]="'INTERNAL_JOBSHEET'"
			[service]="InternalJobsheetService"
			[LinkActions]="LinkActions"
			[LinkSelectors]="LinkSelectors"
			[PNSActions]="PNSActions"
			[PNSSelectors]="PNSSelectors"
			(addKO)="onKnockoffAdd($event)"
			(showDetails)="onKnockoffEdit($event)"
		></app-doc-link-ko-for>
	</mat-tab>

  <mat-tab label="KO By Delivery Order Item">
		<app-doc-link-ko-by
			[selectedLineItem$]="lineItem$"
			[links$]="links$"
			[hdr]="draft$ | async"
			[AppletConstants]="AppletConstants"
			[serverDocTypeDoc2]="'INTERNAL_OUTBOUND_DELIVERY_ORDER'"
			[service]="InternalOutboundDeliveryOrderService"
		></app-doc-link-ko-by>
	</mat-tab>
	<mat-tab label="KO For Delivery Order Item">
		<app-doc-link-ko-for
			[localState]="localState$ | async"
			[selectedLineItem$]="lineItem$"
			[links$]="links$"
			[hdr]="draft$ | async"
			[store]="store"
			[GenDocActions]="GenDocActions"
			[draftStore]="draftStore"
			[AppletConstants]="AppletConstants"
			[serverDocTypeDoc1]="'INTERNAL_OUTBOUND_DELIVERY_ORDER'"
			[service]="InternalOutboundDeliveryOrderService"
			[LinkActions]="LinkActions"
			[LinkSelectors]="LinkSelectors"
			[PNSActions]="PNSActions"
			[PNSSelectors]="PNSSelectors"
			(addKO)="onKnockoffAdd($event)"
			(showDetails)="onKnockoffEdit($event)"
		></app-doc-link-ko-for>
	</mat-tab> -->

  <mat-tab *ngIf="subItemType === SUB_ITEM_TYPE.binNumber && !appletSettings.HIDE_BIN_NUMBER">
    <ng-template mat-tab-label>
      <span [style.color]="binNumberTabInvalid ? 'red' : 'inherit'" 
            [style.font-weight]="binNumberTabInvalid ? 'bold' : 'normal'">
        Bin Number
      </span>
    </ng-template>
    <app-line-item-add-bin-number [editMode]="true"></app-line-item-add-bin-number>
  </mat-tab>

</mat-tab-group>

<mat-accordion *ngIf="showPanels()" [multi]="true">
	<mat-expansion-panel [expanded]="true">
		<mat-expansion-panel-header>
			<mat-panel-title>
			Item Details
			  </mat-panel-title>
		</mat-expansion-panel-header>
		<app-line-item-details [selectedIndex]="itemSelectedIndex$" [editMode]="true"></app-line-item-details>
	</mat-expansion-panel>

	<mat-expansion-panel *ngIf="subItemType === 'SERIAL_NUMBER'">
		<mat-expansion-panel-header>
			<mat-panel-title>
			  Serial Number
			</mat-panel-title>
		</mat-expansion-panel-header>
		<app-util-line-item-serial-number
		[selectedIndex$]="serialSelectedIndex$"
		[editMode]="true"
		[txnType] = "'PURCHASE'"
		[postingStatus] = "postingStatus"
		[viewModelStore]="viewModelStore"
		[ColumnViewActions]="ColumnViewActions"
		[ColumnViewSelectors]="ColumnViewSelectors"
		[serialNumberListing$] ="serialNumberListing$"
		[draft$] ="draft$"
		[invItem$] ="invItem$"
		[lineItem] ="docline$ | async"
		[serverDocType]="serverDocType"
		></app-util-line-item-serial-number>
	</mat-expansion-panel>

	<mat-expansion-panel *ngIf="!appletSettings.HIDE_COSTING_DETAILS || showCostingDetails">
		<mat-expansion-panel-header>
			<mat-panel-title>
			  Costing Details
			</mat-panel-title>
		</mat-expansion-panel-header>
		<app-line-item-costing-details></app-line-item-costing-details>
	</mat-expansion-panel>

	<mat-expansion-panel>
	  <mat-expansion-panel-header>
		  <mat-panel-title>
			Issue Link
		  </mat-panel-title>
	  </mat-expansion-panel-header>
	  <app-line-item-issue-link-listing (editIssueLink)="goToEditIssueLink()"></app-line-item-issue-link-listing>
  </mat-expansion-panel>
  </mat-accordion>

<div style="padding: 5px;">
  <button mat-raised-button color="warn" type="button" (click)="onDelete()" *ngIf="deleteCondition()">
    <span>{{ (deleteConfirmation$ | async) ? 'CLICK AGAIN TO CONFIRM' : 'DELETE'}}</span>
  </button>
</div>
